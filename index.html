<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SisKA Laporan Aktiviti Asrama</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=IBM+Plex+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --secondary: #0891b2;
            --accent: #f59e0b;
            --success: #059669;
            --danger: #dc2626;
            --like-color: #e11d48;
            --like-bg: #fff1f2;
            --bg-main: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
        }

        body {
            font-family: 'IBM Plex Sans', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 1.5rem;
            color: var(--text-primary);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-card);
            border-radius: 1rem;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .header-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-placeholder {
            width: 70px;
            height: 70px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--primary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            overflow: hidden;
            padding: 5px;
        }

        .logo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .header-title {
            flex: 1;
            text-align: center;
        }

        .header-title h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header-title p {
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 500;
        }

        .tabs {
            display: flex;
            background: var(--bg-main);
            border-bottom: 2px solid var(--border);
        }

        .tab {
            flex: 1;
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            position: relative;
            font-family: 'Poppins', sans-serif;
        }

        .tab:hover {
            background: rgba(30, 64, 175, 0.05);
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            background: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: scaleX(0); }
            to { transform: scaleX(1); }
        }

        .tab-content {
            display: none;
            padding: 2rem;
            animation: fadeIn 0.4s ease;
        }

        .tab-content.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .dashboard-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .page-info {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .nav-btn:disabled {
            background: var(--border);
            cursor: not-allowed;
            opacity: 0.5;
        }

        /* ============================================
           REPORT CARD
        ============================================ */
        .report-card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            display: grid;
            grid-template-columns: 200px 1fr 250px;
            gap: 1.5rem;
            align-items: start;
            position: relative;
        }

        .report-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .report-date {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .date-day {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Poppins', sans-serif;
        }

        .date-details {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .report-content h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .report-content p {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .report-images { display: block; }

        .report-image {
            width: 100%;
            height: 180px;
            background: var(--bg-main);
            border-radius: 0.5rem;
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .report-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ============================================
           LIKE BUTTON SYSTEM
        ============================================ */
        .report-footer {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            margin-top: 0.5rem;
        }

        .like-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .like-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.1rem;
            border: 2px solid var(--border);
            border-radius: 2rem;
            background: white;
            cursor: pointer;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
            user-select: none;
            position: relative;
            overflow: hidden;
        }

        .like-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--like-bg);
            opacity: 0;
            transition: opacity 0.25s ease;
        }

        .like-btn:hover::before { opacity: 1; }

        .like-btn:hover {
            border-color: var(--like-color);
            color: var(--like-color);
            transform: scale(1.05);
        }

        .like-btn.liked {
            border-color: var(--like-color);
            background: var(--like-bg);
            color: var(--like-color);
        }

        .like-btn.liked .heart-icon {
            animation: heartPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .heart-icon {
            font-size: 1.1rem;
            display: inline-block;
            transition: transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            z-index: 1;
        }

        .like-btn:hover .heart-icon {
            transform: scale(1.2);
        }

        .like-count {
            font-size: 0.9rem;
            font-weight: 700;
            position: relative;
            z-index: 1;
            transition: all 0.3s ease;
        }

        .like-label {
            font-size: 0.85rem;
            position: relative;
            z-index: 1;
        }

        @keyframes heartPop {
            0%   { transform: scale(1); }
            30%  { transform: scale(1.5) rotate(-10deg); }
            60%  { transform: scale(0.9) rotate(5deg); }
            100% { transform: scale(1) rotate(0deg); }
        }

        /* Floating hearts burst animation */
        @keyframes floatUp {
            0%   { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(0.5); }
        }

        .floating-heart {
            position: absolute;
            font-size: 1rem;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            z-index: 999;
        }

        /* Like count bounce animation */
        @keyframes countBounce {
            0%   { transform: translateY(0); }
            40%  { transform: translateY(-6px); }
            70%  { transform: translateY(2px); }
            100% { transform: translateY(0); }
        }

        .like-count.animating {
            animation: countBounce 0.4s ease;
        }

        /* Liked-by avatars (mock) */
        .liked-by {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .liked-by-avatars {
            display: flex;
        }

        .avatar-bubble {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid white;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
            color: white;
            font-weight: 700;
            margin-left: -6px;
        }

        .avatar-bubble:first-child { margin-left: 0; }

        .avatar-bubble.pink   { background: linear-gradient(135deg, #f43f5e, #e11d48); }
        .avatar-bubble.blue   { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .avatar-bubble.green  { background: linear-gradient(135deg, #10b981, #047857); }
        .avatar-bubble.amber  { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .avatar-bubble.purple { background: linear-gradient(135deg, #8b5cf6, #6d28d9); }

        /* ============================================
           FORM STYLES
        ============================================ */
        .form-group { margin-bottom: 1.5rem; }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-family: 'Poppins', sans-serif;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-size: 1rem;
            font-family: 'IBM Plex Sans', sans-serif;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .single-upload-container { max-width: 500px; }

        .upload-box-large {
            aspect-ratio: 16/9;
            border: 2px dashed var(--border);
            border-radius: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-main);
            padding: 2rem;
        }

        .upload-box-large:hover {
            border-color: var(--primary);
            background: rgba(30, 64, 175, 0.05);
        }

        .upload-box-large svg {
            width: 60px;
            height: 60px;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .upload-box-large span {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 600;
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--success) 0%, #047857 100%);
            color: white;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            box-shadow: var(--shadow-md);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            background: rgba(30, 64, 175, 0.1);
            color: var(--primary);
            margin-top: 0.5rem;
        }

        /* ============================================
           MODAL
        ============================================ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s ease;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 1.5rem;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px; height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .modal-close:hover { background: rgba(255,255,255,0.2); }

        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            background: var(--bg-main);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .btn-print {
            padding: 0.75rem 1.5rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-print:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-cancel {
            padding: 0.75rem 1.5rem;
            background: white;
            color: var(--text-primary);
            border: 2px solid var(--border);
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-cancel:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Print Template */
        .print-template {
            background: white;
            padding: 1.5rem;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .print-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-bottom: 1.5rem;
            border-bottom: 3px solid var(--primary);
            margin-bottom: 2rem;
        }

        .print-logo { width: 60px; height: 60px; }
        .print-logo img { width: 100%; height: 100%; object-fit: contain; }

        .print-title {
            flex: 1;
            text-align: center;
            padding: 0 1rem;
        }

        .print-title h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .print-title p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .print-section { margin-bottom: 1.5rem; }

        .print-section-title {
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .print-info-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .print-label { font-weight: 600; color: var(--text-secondary); }
        .print-value { color: var(--text-primary); }

        .print-image-container {
            margin: 1.5rem 0;
            text-align: center;
        }

        .print-image-container img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 0.5rem;
            border: 1px solid var(--border);
        }

        .print-footer {
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .clickable-row {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* ============================================
           LOADING OVERLAY
        ============================================ */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.95);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 1rem;
        }

        .loading-overlay.active { display: flex; }

        .loading-spinner {
            width: 50px; height: 50px;
            border: 4px solid var(--border);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0%   { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-family: 'Poppins', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
        }

        .loading-subtext {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* ============================================
           RESPONSIVE
        ============================================ */
        @media (max-width: 768px) {
            .header { text-align: center; }
            .header-title h1 { font-size: 1.2rem; }
            .report-card {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .tab { padding: 0.75rem 1rem; font-size: 0.9rem; }
            .dashboard-controls { flex-direction: column; align-items: stretch; }
            .nav-buttons { justify-content: center; }
            .report-footer { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
        }

        /* ============================================
           PRINT STYLES
        ============================================ */
        @media print {
            @page { size: A4 portrait; margin: 1.5cm; }

            body > *:not(#printModal) { display: none !important; }

            #printModal {
                display: block !important;
                position: static !important;
                background: white !important;
            }

            .modal-header, .modal-footer, .modal-close { display: none !important; }

            .modal-content {
                width: 100% !important;
                max-width: 100% !important;
                max-height: none !important;
                box-shadow: none !important;
                border-radius: 0 !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .modal-body { padding: 0 !important; overflow: visible !important; }

            .print-template {
                display: block !important;
                visibility: visible !important;
                position: static !important;
                width: 100% !important;
                padding: 1cm !important;
            }

            .print-template * { visibility: visible !important; }
            .print-section { page-break-inside: avoid; }
            .print-header { page-break-after: avoid; }
            .print-image-container img { max-width: 100% !important; height: auto !important; page-break-inside: avoid; }
        }

        /* ============================================
           GALERI TAB
        ============================================ */
        .galeri-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .galeri-count-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .galeri-count-label strong {
            color: var(--primary);
            font-size: 1rem;
        }

        .galeri-search-wrap {
            position: relative;
            width: 280px;
        }

        .galeri-search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            color: var(--text-secondary);
            pointer-events: none;
        }

        #galeriSearch {
            width: 100%;
            padding: 0.6rem 1rem 0.6rem 2.4rem;
            border: 2px solid var(--border);
            border-radius: 2rem;
            font-size: 0.9rem;
            font-family: 'IBM Plex Sans', sans-serif;
            transition: all 0.3s ease;
            background: var(--bg-main);
        }

        #galeriSearch:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        /* Masonry-style CSS column grid */
        .galeri-grid {
            columns: 4 200px;
            column-gap: 1rem;
        }

        .galeri-tile {
            break-inside: avoid;
            margin-bottom: 1rem;
            border-radius: 0.75rem;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease;
            background: var(--bg-main);
            animation: tileIn 0.4s ease both;
        }

        @keyframes tileIn {
            from { opacity: 0; transform: scale(0.92); }
            to   { opacity: 1; transform: scale(1);    }
        }

        .galeri-tile:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(30, 64, 175, 0.18);
            z-index: 1;
        }

        .galeri-tile img {
            width: 100%;
            display: block;
            transition: transform 0.4s ease;
        }

        .galeri-tile:hover img {
            transform: scale(1.05);
        }

        /* Hover overlay */
        .galeri-tile-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(15,23,42,0.85) 0%, rgba(15,23,42,0) 55%);
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 0.85rem;
        }

        .galeri-tile:hover .galeri-tile-overlay {
            opacity: 1;
        }

        .galeri-tile-date {
            font-family: 'Poppins', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            color: #93c5fd;
            letter-spacing: 0.3px;
            margin-bottom: 0.25rem;
        }

        .galeri-tile-caption {
            font-size: 0.78rem;
            color: rgba(255,255,255,0.88);
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Zoom icon badge */
        .galeri-tile-zoom {
            position: absolute;
            top: 0.6rem;
            right: 0.6rem;
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.92);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.7);
            transition: opacity 0.25s ease, transform 0.25s ease;
            backdrop-filter: blur(4px);
        }

        .galeri-tile-zoom svg {
            width: 16px;
            height: 16px;
            color: var(--primary);
        }

        .galeri-tile:hover .galeri-tile-zoom {
            opacity: 1;
            transform: scale(1);
        }

        /* Badge: "Terkini" ribbon */
        .galeri-tile-new {
            position: absolute;
            top: 0;
            left: 0;
            background: linear-gradient(135deg, var(--accent), #d97706);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            font-family: 'Poppins', sans-serif;
            padding: 0.25rem 0.6rem 0.25rem 0.5rem;
            border-radius: 0 0 0.5rem 0;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* No-image placeholder tile */
        .galeri-tile-placeholder {
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 140px;
            gap: 0.5rem;
            color: var(--text-secondary);
        }

        .galeri-tile-placeholder svg {
            width: 36px;
            height: 36px;
            opacity: 0.5;
        }

        .galeri-tile-placeholder span {
            font-size: 0.78rem;
            font-weight: 500;
        }

        .galeri-empty {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-secondary);
        }

        .galeri-empty svg {
            width: 70px;
            height: 70px;
            margin: 0 auto 1rem;
            opacity: 0.35;
            display: block;
        }

        .galeri-empty p {
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            font-weight: 500;
        }

        /* ============================================
           LIGHTBOX
        ============================================ */
        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: rgba(5, 10, 25, 0.96);
            backdrop-filter: blur(6px);
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: lbFadeIn 0.3s ease;
        }

        .lightbox.lb-active { display: flex; }

        @keyframes lbFadeIn {
            from { opacity: 0; }
            to   { opacity: 1; }
        }

        /* Close button */
        .lb-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.12);
            border: 1.5px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.25s ease, transform 0.25s ease;
            z-index: 10;
        }

        .lb-close:hover {
            background: rgba(255,255,255,0.25);
            transform: rotate(90deg) scale(1.1);
        }

        .lb-close svg { width: 20px; height: 20px; }

        /* Counter badge */
        .lb-counter {
            position: absolute;
            top: 1.1rem;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Poppins', sans-serif;
            font-size: 0.85rem;
            font-weight: 600;
            color: rgba(255,255,255,0.65);
            background: rgba(255,255,255,0.1);
            padding: 0.3rem 1rem;
            border-radius: 2rem;
            border: 1px solid rgba(255,255,255,0.15);
            backdrop-filter: blur(4px);
            z-index: 10;
            white-space: nowrap;
        }

        /* Arrows */
        .lb-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 52px;
            height: 52px;
            background: rgba(255,255,255,0.12);
            border: 1.5px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.25s ease, transform 0.25s ease;
            z-index: 10;
        }

        .lb-arrow svg { width: 22px; height: 22px; }

        .lb-prev { left: 1.25rem; }
        .lb-next { right: 1.25rem; }

        .lb-prev:hover { background: rgba(255,255,255,0.25); transform: translateY(-50%) translateX(-3px); }
        .lb-next:hover { background: rgba(255,255,255,0.25); transform: translateY(-50%) translateX(3px); }

        .lb-arrow:disabled {
            opacity: 0.25;
            cursor: not-allowed;
        }

        /* Image stage */
        .lb-stage {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            flex: 1;
            padding: 4.5rem 5rem 0.5rem;
            min-height: 0;
        }

        .lb-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 0.5rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6);
            animation: lbImgIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: block;
        }

        @keyframes lbImgIn {
            from { opacity: 0; transform: scale(0.92); }
            to   { opacity: 1; transform: scale(1); }
        }

        /* Spinner */
        .lb-spinner {
            position: absolute;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.15);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Caption */
        .lb-caption {
            width: 100%;
            max-width: 700px;
            text-align: center;
            padding: 0.75rem 1rem 0.5rem;
            flex-shrink: 0;
        }

        .lb-caption-date {
            font-family: 'Poppins', sans-serif;
            font-size: 0.8rem;
            font-weight: 700;
            color: #93c5fd;
            letter-spacing: 0.5px;
            margin-bottom: 0.3rem;
        }

        .lb-caption-text {
            font-size: 0.88rem;
            color: rgba(255,255,255,0.75);
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        /* Thumbnail strip */
        .lb-strip {
            display: flex;
            gap: 0.5rem;
            overflow-x: auto;
            padding: 0.75rem 1rem 1rem;
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.3) transparent;
            max-width: 100%;
            flex-shrink: 0;
        }

        .lb-strip::-webkit-scrollbar { height: 4px; }
        .lb-strip::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 2px; }

        .lb-thumb {
            width: 60px;
            height: 60px;
            flex-shrink: 0;
            border-radius: 0.375rem;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            opacity: 0.55;
            transition: all 0.25s ease;
        }

        .lb-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .lb-thumb:hover { opacity: 0.85; border-color: rgba(255,255,255,0.5); }
        .lb-thumb.lb-thumb-active { border-color: #60a5fa; opacity: 1; }

        /* No-image in lightbox */
        .lb-no-image {
            width: 220px;
            height: 160px;
            border-radius: 0.75rem;
            background: rgba(255,255,255,0.07);
            border: 2px dashed rgba(255,255,255,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            color: rgba(255,255,255,0.4);
        }

        .lb-no-image svg { width: 48px; height: 48px; }
        .lb-no-image span { font-size: 0.85rem; font-family: 'Poppins', sans-serif; }

        @media (max-width: 768px) {
            .galeri-grid { columns: 2 140px; }
            .galeri-search-wrap { width: 100%; }
            .lb-arrow { width: 40px; height: 40px; }
            .lb-prev { left: 0.5rem; }
            .lb-next { right: 0.5rem; }
            .lb-stage { padding: 4rem 3.5rem 0.5rem; }
            .lb-thumb { width: 48px; height: 48px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logo">
                <div class="logo-placeholder">
                    <img src="https://i.postimg.cc/G23tcFnW/Logo-SK-Adin.png" alt="Logo SK Adin">
                </div>
            </div>
            <div class="header-title">
                <h1>LAPORAN SisKA & AKTIVITI ASRAMA</h1>
                <p>SEKOLAH KEBANGSAAN ADIN, SARIKEI (YBB6102)</p>
            </div>
            <div class="logo-placeholder">
                <img src="https://i.postimg.cc/Njd1dGKk/Ts25-Program-Transformasi-Sekolah-2025-Logo-Vector-svg.png" alt="TS25 Logo">
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('dashboard', this)">
                üìä Dashboard
            </button>
            <button class="tab" onclick="switchTab('galeri', this)">
                üñºÔ∏è Galeri
            </button>
            <button class="tab" onclick="switchTab('laporan', this)">
                ‚úèÔ∏è Laporan Baru
            </button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-controls">
                <div class="page-info">
                    Menunjukkan <strong>1-5</strong> daripada <strong>23</strong> laporan
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn" disabled>‚Üê Sebelum</button>
                    <button class="nav-btn">Seterusnya ‚Üí</button>
                </div>
            </div>

            <div class="reports-list" style="display: none;"></div>
        </div>

        <!-- Galeri Tab -->
        <div id="galeri" class="tab-content">

            <!-- Galeri Controls Bar -->
            <div class="galeri-controls">
                <div class="galeri-info">
                    <span class="galeri-count-label">Jumlah gambar: <strong id="galeriTotal">‚Äì</strong></span>
                </div>
                <div class="galeri-search-wrap">
                    <svg class="galeri-search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M21 21l-4.35-4.35m0 0A7 7 0 104.65 4.65a7 7 0 0011.99 11.99z"/>
                    </svg>
                    <input type="text" id="galeriSearch" placeholder="Cari mengikut tarikh atau butiran‚Ä¶"
                           oninput="filterGaleri(this.value)">
                </div>
            </div>

            <!-- Masonry-style Grid -->
            <div class="galeri-grid" id="galeriGrid">
                <!-- Tiles injected by JS -->
            </div>

            <!-- Empty state -->
            <div class="galeri-empty" id="galeriEmpty" style="display:none;">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                          d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                <p>Tiada gambar dijumpai</p>
            </div>

            <!-- Load More -->
            <div style="text-align:center; margin-top:2rem;" id="galeriLoadMore" style="display:none;">
                <button class="nav-btn" id="galeriMoreBtn" onclick="galeriLoadMore()">
                    Muat lebih banyak gambar ‚Üì
                </button>
            </div>
        </div>

        <!-- LIGHTBOX OVERLAY -->
        <div id="lightbox" class="lightbox" role="dialog" aria-modal="true" aria-label="Pemapar gambar">
            <button class="lb-close" onclick="closeLightbox()" title="Tutup (Esc)">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>

            <!-- Counter badge -->
            <div class="lb-counter" id="lbCounter">1 / 1</div>

            <!-- Prev / Next -->
            <button class="lb-arrow lb-prev" onclick="changeLightbox(-1)" title="Sebelum (‚Üê)">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"/>
                </svg>
            </button>

            <div class="lb-stage">
                <div class="lb-spinner" id="lbSpinner"></div>
                <img class="lb-img" id="lbImg" src="" alt="Gambar Aktiviti"
                     onload="document.getElementById('lbSpinner').style.display='none'"
                     onerror="lbImgError(this)">
            </div>

            <button class="lb-arrow lb-next" onclick="changeLightbox(1)" title="Seterusnya (‚Üí)">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/>
                </svg>
            </button>

            <!-- Caption Strip -->
            <div class="lb-caption" id="lbCaption">
                <div class="lb-caption-date" id="lbDate"></div>
                <div class="lb-caption-text" id="lbText"></div>
            </div>

            <!-- Thumbnail Strip -->
            <div class="lb-strip" id="lbStrip"></div>
        </div>

        <!-- Laporan Tab -->
        <div id="laporan" class="tab-content">
            <form id="reportForm">
                <div class="form-group">
                    <label for="tarikh">Tarikh</label>
                    <input type="date" id="tarikh" required>
                </div>

                <div class="form-group">
                    <label for="masa">Masa</label>
                    <input type="text" id="masa" placeholder="Contoh: 0500-0515 atau 1600-1700" required>
                    <small style="color: var(--text-secondary); margin-top: 0.5rem; display: block;">
                        Format: 0500-0515 (akan jadi 5.00 - 5.15 pagi) atau 1600-1700 (akan jadi 4.00 - 5.00 petang)
                    </small>
                </div>

                <div class="form-group">
                    <label for="butiran">Butiran Aktiviti</label>
                    <textarea id="butiran" rows="12" style="width: 100%;" placeholder="Tuliskan butiran aktiviti SisKA atau aktiviti asrama di sini...Contohnya:&#10;&#10;Pelaporan perlu menyentuh perkembangan murid dalam empat aspek kritikal bagi memastikan kemenjadian murid asrama tercapai:&#10;&#10;Sahsiah dan Disiplin: Mengesan perubahan tingkah laku positif dan penerapan nilai kasih sayang.&#10;Akademik: Laporan bimbingan kelas kecil atau bantuan pembelajaran secara tidak formal di asrama.&#10;Sosial dan Kepimpinan: Bagaimana murid Tahun 6 memainkan peranan sebagai 'Abang atau Kakak' kepada murid yang lebih muda.&#10;Kerohanian dan Emosi: Aspek paling penting bagi murid luar bandar untuk memastikan keperluan emosi mereka dipenuhi agar mereka merasa selamat dan disayangi." required></textarea>
                </div>

                <div class="form-group">
                    <label>Gambar</label>
                    <div class="single-upload-container">
                        <div class="upload-box-large" id="uploadBox" onclick="document.getElementById('fileInput').click()">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span>Klik untuk pilih gambar</span>
                            <small style="color: var(--text-secondary); margin-top: 0.5rem;">Format: JPG, PNG, JPEG (Max 5MB)</small>
                            <input type="file" id="fileInput" accept="image/jpeg,image/png,image/jpg" style="display: none;" onchange="previewImage(this)">
                        </div>
                        <div id="imagePreview" style="display: none; margin-top: 1rem;">
                            <img id="previewImg" style="max-width: 100%; border-radius: 0.5rem; border: 2px solid var(--border);">
                            <button type="button" onclick="removeImage()" style="margin-top: 0.5rem; padding: 0.5rem 1rem; background: var(--danger); color: white; border: none; border-radius: 0.375rem; cursor: pointer;">
                                üóëÔ∏è Buang Gambar
                            </button>
                        </div>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 2rem;">
                    <button type="submit" class="btn-submit">üíæ Simpan Laporan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Sedang memuat data...</div>
        <div class="loading-subtext">Sila tunggu sebentar</div>
    </div>

    <!-- Print Preview Modal -->
    <div id="printModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üëÅÔ∏è Preview Cetak Laporan</h2>
                <button class="modal-close" onclick="closePrintModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="print-template" id="printContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closePrintModal()">Batal</button>
                <button class="btn-print" onclick="printReport()">üñ®Ô∏è Cetak</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // GOOGLE SHEETS CONFIGURATION
        // ============================================
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzapROky7x_XaMlZLG73OvPP1SbayNsSHvg2NkzGDl0Caue2cFAWr71bdx-KFSokEkJYA/exec';
        const DRIVE_FOLDER_ID = '1flKrpPwy1D1t48CnJKanL5U2JC5hYqKn';

        // ============================================
        // LIKE SYSTEM ‚Äî MOCK DATA & LOGIC
        // ============================================

        /**
         * Mock avatar pool ‚Äî cycles through available initials/colours
         */
        const AVATAR_POOL = [
            { initial: 'A', cls: 'pink'   },
            { initial: 'B', cls: 'blue'   },
            { initial: 'N', cls: 'green'  },
            { initial: 'S', cls: 'amber'  },
            { initial: 'H', cls: 'purple' },
            { initial: 'R', cls: 'pink'   },
            { initial: 'Z', cls: 'blue'   },
            { initial: 'F', cls: 'green'  },
            { initial: 'M', cls: 'amber'  },
            { initial: 'Y', cls: 'purple' },
        ];

        /**
         * Compute mock like count for a report based on its position (1-indexed).
         *
         * Position 1 (newest)  ‚Üí 1 like
         * Position 2           ‚Üí 1 + 2 = 3 likes
         * Position 3           ‚Üí 3 + 3 = 6 likes
         * Position n           ‚Üí n*(n+1)/2 likes  (triangular number)
         *
         * @param {number} position  1 = newest report
         */
        function getMockLikeCount(position) {
            return (position * (position + 1)) / 2;
        }

        /**
         * In-memory like state (persisted via window.storage when available).
         * Key: uniqueId of report ‚Üí { count, liked }
         */
        let likeState = {};

        async function loadLikeState() {
            try {
                const result = await window.storage.get('siska-likes');
                if (result && result.value) {
                    likeState = JSON.parse(result.value);
                }
            } catch (_) {
                // storage not available or key missing ‚Äî start fresh
                likeState = {};
            }
        }

        async function saveLikeState() {
            try {
                await window.storage.set('siska-likes', JSON.stringify(likeState));
            } catch (_) {
                // silent ‚Äî storage may not be available outside Claude.ai
            }
        }

        /**
         * Return current like count for a report.
         * Falls back to mock count (based on position) if never interacted.
         */
        function getLikeCount(uniqueId, position) {
            if (likeState[uniqueId] !== undefined) {
                return likeState[uniqueId].count;
            }
            return getMockLikeCount(position);
        }

        function isLiked(uniqueId) {
            return likeState[uniqueId] && likeState[uniqueId].liked;
        }

        /**
         * Toggle like for a report.
         * Returns the new like count.
         */
        async function toggleLike(uniqueId, position, countEl, btnEl) {
            const currentCount = getLikeCount(uniqueId, position);
            const currentlyLiked = isLiked(uniqueId);
            const newLiked = !currentlyLiked;
            const newCount = newLiked ? currentCount + 1 : Math.max(0, currentCount - 1);

            // Persist state
            likeState[uniqueId] = { count: newCount, liked: newLiked };
            await saveLikeState();

            // Update button appearance
            if (newLiked) {
                btnEl.classList.add('liked');
                btnEl.querySelector('.heart-icon').textContent = '‚ù§Ô∏è';
            } else {
                btnEl.classList.remove('liked');
                btnEl.querySelector('.heart-icon').textContent = 'ü§ç';
            }

            // Animate count
            countEl.textContent = formatLikeCount(newCount);
            countEl.classList.remove('animating');
            void countEl.offsetWidth; // reflow
            countEl.classList.add('animating');
            setTimeout(() => countEl.classList.remove('animating'), 400);

            // Update label
            const labelEl = btnEl.querySelector('.like-label');
            labelEl.textContent = newCount === 1 ? 'suka' : 'suka';

            // Spawn floating hearts if liking
            if (newLiked) {
                spawnFloatingHearts(btnEl);
            }

            // Update liked-by avatars
            updateLikedByAvatars(uniqueId, position, newCount, btnEl.closest('.report-footer'));
        }

        function formatLikeCount(n) {
            if (n >= 1000) return (n / 1000).toFixed(1) + 'k';
            return n;
        }

        /** Spawn a burst of floating hearts near the like button */
        function spawnFloatingHearts(btnEl) {
            const rect = btnEl.getBoundingClientRect();
            const count = 4 + Math.floor(Math.random() * 3); // 4‚Äì6 hearts

            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const heart = document.createElement('span');
                    heart.className = 'floating-heart';
                    heart.textContent = ['‚ù§Ô∏è','ü©∑','üíï','üíó'][Math.floor(Math.random() * 4)];
                    heart.style.left = (rect.left + rect.width / 2 + (Math.random() - 0.5) * 60) + 'px';
                    heart.style.top  = (rect.top  + window.scrollY - 10) + 'px';
                    heart.style.animationDuration = (0.6 + Math.random() * 0.4) + 's';
                    document.body.appendChild(heart);
                    setTimeout(() => heart.remove(), 1000);
                }, i * 80);
            }
        }

        /** Render liked-by avatar stack + text */
        function updateLikedByAvatars(uniqueId, position, count, footerEl) {
            const likedByEl = footerEl.querySelector('.liked-by');
            if (!likedByEl) return;

            if (count === 0) {
                likedByEl.innerHTML = '<span style="font-style:italic;">Belum ada yang suka lagi</span>';
                return;
            }

            const showAvatars = Math.min(count, 5);
            const avatarHtml = Array.from({ length: showAvatars }, (_, i) => {
                const av = AVATAR_POOL[(position + i) % AVATAR_POOL.length];
                return `<div class="avatar-bubble ${av.cls}">${av.initial}</div>`;
            }).join('');

            const othersCount = count - showAvatars;
            const othersText = othersCount > 0
                ? ` dan <strong>${othersCount}</strong> orang lain`
                : '';

            const firstName = AVATAR_POOL[position % AVATAR_POOL.length].initial;

            likedByEl.innerHTML = `
                <div class="liked-by-avatars">${avatarHtml}</div>
                <span>${firstName}${othersText} menyukai ini</span>
            `;
        }

        // ============================================
        // TIME FORMATTING FUNCTIONS
        // ============================================
        function formatTime(timeInput) {
            timeInput = timeInput.replace(/\s+/g, '').toUpperCase();
            let match = timeInput.match(/(\d{4})[-‚Äì‚Äî]?(\d{4})?/);

            if (!match) throw new Error('Format masa tidak sah. Guna format: 0500-0515 atau 1600-1700');

            const startTime = match[1];
            const endTime   = match[2] || '';

            const startHour = parseInt(startTime.substring(0, 2));
            const startMin  = startTime.substring(2, 4);

            if (startHour < 0 || startHour > 23 || parseInt(startMin) < 0 || parseInt(startMin) > 59)
                throw new Error('Masa tidak sah. Pastikan jam (00-23) dan minit (00-59) betul.');

            let period = startHour < 12 ? 'pagi' : startHour < 18 ? 'petang' : 'malam';

            let displayStartHour = startHour === 0 ? 12 : startHour > 12 ? startHour - 12 : startHour;
            let formattedTime = `${displayStartHour}.${startMin}`;

            if (endTime) {
                const endHour = parseInt(endTime.substring(0, 2));
                const endMin  = endTime.substring(2, 4);

                if (endHour < 0 || endHour > 23 || parseInt(endMin) < 0 || parseInt(endMin) > 59)
                    throw new Error('Masa tamat tidak sah. Pastikan jam (00-23) dan minit (00-59) betul.');

                let displayEndHour = endHour === 0 ? 12 : endHour > 12 ? endHour - 12 : endHour;
                formattedTime += ` - ${displayEndHour}.${endMin}`;
            }

            return `${formattedTime} ${period}`;
        }

        function createUniqueId(dateStr, timeStr) {
            const [year, month, day] = dateStr.split('-');
            const timeMatch = timeStr.replace(/\s+/g, '').match(/(\d{4})/);
            const time = timeMatch ? timeMatch[1] : '0000';
            return `${year}${month}${day}_${time}`;
        }

        // ============================================
        // IMAGE PREVIEW FUNCTIONS
        // ============================================
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                if (file.size > 5 * 1024 * 1024) { alert('Saiz gambar terlalu besar! Maksimum 5MB.'); input.value = ''; return; }
                if (!file.type.match('image/(jpeg|jpg|png)')) { alert('Format gambar tidak sah! Gunakan JPG, JPEG atau PNG sahaja.'); input.value = ''; return; }
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    document.getElementById('uploadBox').style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function removeImage() {
            document.getElementById('fileInput').value = '';
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('uploadBox').style.display = 'flex';
        }

        // ============================================
        // LOADING OVERLAY FUNCTIONS
        // ============================================
        function showLoading(message = 'Sedang memuat data...', subtext = 'Sila tunggu sebentar') {
            const overlay = document.getElementById('loadingOverlay');
            overlay.querySelector('.loading-text').textContent = message;
            overlay.querySelector('.loading-subtext').textContent = subtext;
            overlay.classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // ============================================
        // PRINT PREVIEW FUNCTIONS
        // ============================================
        function openPrintModal(report) {
            const modal = document.getElementById('printModal');
            const printContent = document.getElementById('printContent');

            let imageUrl = report.gambar || '';
            if (imageUrl && imageUrl.includes('drive.google.com')) {
                let fileId = '';
                if (imageUrl.includes('id=')) fileId = imageUrl.split('id=')[1].split('&')[0];
                else if (imageUrl.includes('/file/d/')) fileId = imageUrl.split('/file/d/')[1].split('/')[0];
                if (fileId) imageUrl = `https://drive.google.com/thumbnail?id=${fileId}&sz=w800`;
            }

            printContent.innerHTML = `
                <div class="print-header">
                    <div class="print-logo"><img src="https://i.postimg.cc/G23tcFnW/Logo-SK-Adin.png" alt="Logo SK Adin"></div>
                    <div class="print-title">
                        <h1>LAPORAN SisKA & AKTIVITI ASRAMA</h1>
                        <p>Sekolah Kebangsaan Adin, Sarikei (YBB6102)</p>
                    </div>
                    <div class="print-logo"><img src="https://i.postimg.cc/Njd1dGKk/Ts25-Program-Transformasi-Sekolah-2025-Logo-Vector-svg.png" alt="TS25 Logo"></div>
                </div>
                <div class="print-section">
                    <div class="print-section-title">Maklumat Laporan</div>
                    <div class="print-info-grid">
                        <div class="print-label">Tarikh:</div><div class="print-value">${report.tarikh}</div>
                        <div class="print-label">Hari:</div><div class="print-value">${report.hari}</div>
                        <div class="print-label">Masa:</div><div class="print-value">${report.masa}</div>
                    </div>
                </div>
                <div class="print-section">
                    <div class="print-section-title">Butiran Aktiviti</div>
                    <div class="print-value" style="line-height:1.8;">${report.butiran}</div>
                </div>
                ${imageUrl ? `
                <div class="print-section">
                    <div class="print-section-title">Gambar Aktiviti</div>
                    <div class="print-image-container">
                        <img src="${imageUrl}" alt="Gambar Aktiviti" onerror="this.style.display='none'">
                    </div>
                </div>` : ''}
                <div class="print-footer">Ini adalah janaan digital. Tandatangan tidak diperlukan.</div>
            `;

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closePrintModal() {
            document.getElementById('printModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function printReport() {
            const printContent = document.getElementById('printContent');
            if (!printContent.innerHTML.trim()) { alert('Ralat: Tiada kandungan untuk dicetak.'); return; }
            setTimeout(() => window.print(), 250);
        }

        document.getElementById('printModal').addEventListener('click', function(e) {
            if (e.target === this) closePrintModal();
        });

        document.addEventListener('keydown', e => {
            if (e.key === 'Escape' && document.getElementById('printModal').classList.contains('active')) closePrintModal();
        });

        // ============================================
        // TAB SWITCHING
        // ============================================
        function switchTab(tabName, targetTab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            (targetTab || event.target).classList.add('active');

            if (tabName === 'dashboard') loadReportsFromSheet();
            if (tabName === 'galeri')    loadGaleri();
        }

        // ============================================
        // GALERI DATA STORE
        // ============================================

        // All report objects cached from any load (dashboard or galeri)
        let galeriAllReports   = [];   // full list, newest first
        let galeriFiltered     = [];   // after search filter
        let galeriRenderedCount = 0;
        const GALERI_PAGE_SIZE  = 20;
        let galeriLoaded        = false; // have we fetched at least once?

        /**
         * Merge new reports into galeriAllReports without duplicates.
         * Uses report.uniqueId as key; falls back to tarikh+masa combo.
         */
        function mergeIntoGaleri(reports) {
            const existingIds = new Set(galeriAllReports.map(r => r.uniqueId || (r.tarikh + r.masa)));
            for (const r of reports) {
                const key = r.uniqueId || (r.tarikh + r.masa);
                if (!existingIds.has(key)) {
                    galeriAllReports.push(r);
                    existingIds.add(key);
                }
            }
            // Keep newest first (assume they come ordered already, but sort defensively)
            // galeriAllReports stays in insertion order (newest first from API)
        }

        // ============================================
        // GALERI ‚Äî LOAD & RENDER
        // ============================================

        /**
         * Fetch ALL pages from Google Sheets so the gallery is complete.
         * We re-use the existing API endpoint page-by-page.
         */
        async function loadGaleri() {
            if (galeriLoaded) {
                renderGaleriGrid();
                return;
            }

            showLoading('Memuatkan galeri‚Ä¶', 'Sedang mendapatkan semua gambar');

            try {
                // Fetch page 1 to know totalReports
                const res1 = await fetch(`${GOOGLE_SCRIPT_URL}?action=getReports&page=1`);
                const d1   = await res1.json();

                if (!d1.success) throw new Error('API error');

                mergeIntoGaleri(d1.reports);

                const total      = d1.totalReports || d1.reports.length;
                const totalPages = Math.ceil(total / 5);

                // Fetch remaining pages in parallel
                if (totalPages > 1) {
                    const pagePromises = [];
                    for (let p = 2; p <= totalPages; p++) {
                        pagePromises.push(
                            fetch(`${GOOGLE_SCRIPT_URL}?action=getReports&page=${p}`)
                                .then(r => r.json())
                        );
                    }
                    const results = await Promise.all(pagePromises);
                    results.forEach(d => { if (d.success) mergeIntoGaleri(d.reports); });
                }

                galeriLoaded = true;
                hideLoading();
                renderGaleriGrid();

            } catch (err) {
                console.error('Galeri load error:', err);
                hideLoading();
                renderGaleriGrid(); // show whatever we have
            }
        }

        /** Build / rebuild the visible tile grid from galeriFiltered */
        function renderGaleriGrid(reset = true) {
            const grid    = document.getElementById('galeriGrid');
            const empty   = document.getElementById('galeriEmpty');
            const moreBtn = document.getElementById('galeriLoadMore');

            if (reset) {
                grid.innerHTML       = '';
                galeriRenderedCount  = 0;
                galeriFiltered       = galeriAllReports.filter(r => galeriSearchPredicate(r, currentGaleriQuery));
            }

            document.getElementById('galeriTotal').textContent = galeriAllReports.length;

            if (galeriFiltered.length === 0) {
                empty.style.display = 'block';
                moreBtn.style.display = 'none';
                return;
            }

            empty.style.display = 'none';

            const batch = galeriFiltered.slice(galeriRenderedCount, galeriRenderedCount + GALERI_PAGE_SIZE);
            batch.forEach((report, batchIdx) => {
                const globalIdx = galeriRenderedCount + batchIdx; // 0-indexed in galeriFiltered
                const tile = buildGaleriTile(report, globalIdx, globalIdx === 0 && galeriRenderedCount === 0);
                grid.appendChild(tile);
            });

            galeriRenderedCount += batch.length;

            moreBtn.style.display = galeriRenderedCount < galeriFiltered.length ? 'block' : 'none';
        }

        function galeriLoadMore() {
            renderGaleriGrid(false);
        }

        /** Build one tile DOM element */
        function buildGaleriTile(report, index, isNewest) {
            const tile = document.createElement('div');
            tile.className = 'galeri-tile';
            tile.style.animationDelay = `${(index % GALERI_PAGE_SIZE) * 35}ms`;
            tile.dataset.galeriIndex  = index;

            // Resolve image URL
            let imgSrc = resolveImageUrl(report.gambar || '', 'w400');
            const hasImage = !!report.gambar;

            if (hasImage) {
                tile.innerHTML = `
                    ${isNewest ? '<div class="galeri-tile-new">‚ú¶ Terkini</div>' : ''}
                    <div class="galeri-tile-zoom">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M21 21l-4.35-4.35m0 0A7 7 0 104.65 4.65a7 7 0 0011.99 11.99z"/>
                        </svg>
                    </div>
                    <img src="${imgSrc}" alt="Gambar aktiviti ${report.tarikh}"
                         loading="lazy"
                         onerror="this.closest('.galeri-tile').querySelector('.galeri-tile-overlay').style.background='none'">
                    <div class="galeri-tile-overlay">
                        <div class="galeri-tile-date">üìÖ ${report.hari}, ${report.tarikh} &nbsp;¬∑&nbsp; ${report.masa}</div>
                        <div class="galeri-tile-caption">${report.butiran || ''}</div>
                    </div>
                `;
            } else {
                tile.innerHTML = `
                    ${isNewest ? '<div class="galeri-tile-new">‚ú¶ Terkini</div>' : ''}
                    <div class="galeri-tile-placeholder">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>Tiada gambar</span>
                    </div>
                    <div class="galeri-tile-overlay" style="background:linear-gradient(to top,rgba(15,23,42,0.75),transparent)">
                        <div class="galeri-tile-date">üìÖ ${report.hari}, ${report.tarikh} &nbsp;¬∑&nbsp; ${report.masa}</div>
                        <div class="galeri-tile-caption">${report.butiran || ''}</div>
                    </div>
                `;
            }

            tile.addEventListener('click', () => openLightbox(index));
            return tile;
        }

        // ============================================
        // GALERI SEARCH
        // ============================================
        let currentGaleriQuery = '';

        function filterGaleri(query) {
            currentGaleriQuery = query.trim().toLowerCase();
            renderGaleriGrid(true);
        }

        function galeriSearchPredicate(report, query) {
            if (!query) return true;
            const haystack = [report.tarikh, report.hari, report.masa, report.butiran].join(' ').toLowerCase();
            return haystack.includes(query);
        }

        // ============================================
        // IMAGE URL HELPER
        // ============================================
        function resolveImageUrl(url, size = 'w400') {
            if (!url) return '';
            if (url.includes('drive.google.com')) {
                let fileId = '';
                if (url.includes('id='))        fileId = url.split('id=')[1].split('&')[0];
                else if (url.includes('/file/d/')) fileId = url.split('/file/d/')[1].split('/')[0];
                if (fileId) return `https://drive.google.com/thumbnail?id=${fileId}&sz=${size}`;
            }
            return url;
        }

        // ============================================
        // LIGHTBOX
        // ============================================
        let lbCurrentIndex = 0;

        function openLightbox(index) {
            lbCurrentIndex = index;
            const lb = document.getElementById('lightbox');
            lb.classList.add('lb-active');
            document.body.style.overflow = 'hidden';

            buildLbStrip();
            showLbSlide(index);
        }

        function closeLightbox() {
            document.getElementById('lightbox').classList.remove('lb-active');
            document.body.style.overflow = 'auto';
        }

        function changeLightbox(direction) {
            const newIdx = lbCurrentIndex + direction;
            if (newIdx < 0 || newIdx >= galeriFiltered.length) return;
            lbCurrentIndex = newIdx;
            showLbSlide(lbCurrentIndex);
        }

        function showLbSlide(index) {
            const report   = galeriFiltered[index];
            if (!report) return;

            const total    = galeriFiltered.length;
            const img      = document.getElementById('lbImg');
            const spinner  = document.getElementById('lbSpinner');
            const counter  = document.getElementById('lbCounter');
            const dateEl   = document.getElementById('lbDate');
            const textEl   = document.getElementById('lbText');
            const prevBtn  = document.querySelector('.lb-prev');
            const nextBtn  = document.querySelector('.lb-next');

            // Counter
            counter.textContent = `${index + 1} / ${total}`;

            // Arrows
            prevBtn.disabled = index === 0;
            nextBtn.disabled = index === total - 1;

            // Caption
            dateEl.textContent = `üìÖ ${report.hari}, ${report.tarikh}  ¬∑  ${report.masa}`;
            textEl.textContent  = report.butiran || '';

            // Image
            if (report.gambar) {
                spinner.style.display = 'block';
                img.style.display     = 'block';

                // Animate out ‚Üí in
                img.style.animation = 'none';
                img.offsetWidth;
                img.style.animation = 'lbImgIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1)';

                img.src = resolveImageUrl(report.gambar, 'w1200');
            } else {
                img.style.display     = 'none';
                spinner.style.display = 'none';
                // Show placeholder inside stage
                let placeholder = document.querySelector('.lb-no-image');
                if (!placeholder) {
                    placeholder = document.createElement('div');
                    placeholder.className = 'lb-no-image';
                    placeholder.innerHTML = `
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                  d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <span>Tiada gambar</span>
                    `;
                    document.querySelector('.lb-stage').appendChild(placeholder);
                }
                placeholder.style.display = 'flex';
            }

            // Sync strip
            document.querySelectorAll('.lb-thumb').forEach((th, i) => {
                th.classList.toggle('lb-thumb-active', i === index);
            });

            // Scroll active thumb into view
            const activeThumb = document.querySelector('.lb-thumb-active');
            if (activeThumb) activeThumb.scrollIntoView({ inline: 'center', behavior: 'smooth', block: 'nearest' });
        }

        function lbImgError(img) {
            img.style.display = 'none';
            document.getElementById('lbSpinner').style.display = 'none';
        }

        /** Build the horizontal thumbnail strip */
        function buildLbStrip() {
            const strip = document.getElementById('lbStrip');
            strip.innerHTML = '';

            galeriFiltered.forEach((report, i) => {
                const thumb = document.createElement('div');
                thumb.className = 'lb-thumb' + (i === lbCurrentIndex ? ' lb-thumb-active' : '');

                if (report.gambar) {
                    thumb.innerHTML = `<img src="${resolveImageUrl(report.gambar, 'w120')}" alt="thumb ${i+1}" loading="lazy">`;
                } else {
                    thumb.style.background = '#1e293b';
                    thumb.innerHTML = `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:1.2rem;">üìÑ</div>`;
                }

                thumb.addEventListener('click', () => {
                    lbCurrentIndex = i;
                    showLbSlide(i);
                });
                strip.appendChild(thumb);
            });
        }

        // Keyboard navigation for lightbox
        document.addEventListener('keydown', e => {
            const lb = document.getElementById('lightbox');
            if (!lb.classList.contains('lb-active')) return;
            if (e.key === 'ArrowLeft')  changeLightbox(-1);
            if (e.key === 'ArrowRight') changeLightbox(1);
            if (e.key === 'Escape')     closeLightbox();
        });

        // Click outside image to close
        document.getElementById('lightbox').addEventListener('click', function(e) {
            if (e.target === this) closeLightbox();
        });

        // ============================================
        // GOOGLE SHEETS FUNCTIONS
        // ============================================
        async function loadReportsFromSheet() {
            showLoading();
            try {
                const response = await fetch(`${GOOGLE_SCRIPT_URL}?action=getReports&page=${currentPage}`);
                const data = await response.json();
                if (data.success) {
                    hideLoading();
                    displayReports(data.reports);
                    document.querySelector('.reports-list').style.display = 'block';
                    updatePaginationInfo(data.totalReports);
                }
            } catch (error) {
                console.error('Error loading reports:', error);
                hideLoading();
            }
        }

        function displayReports(reports) {
            const reportsList = document.querySelector('.reports-list');
            reportsList.innerHTML = '';

            // Cache into galeri store (dashboard data is always newest first per page)
            mergeIntoGaleri(reports);

            reports.forEach((report, index) => {
                const card = createReportCard(report, index === 0, index + 1 + (currentPage - 1) * 5);
                reportsList.appendChild(card);
            });
        }

        /**
         * Create report card with like button.
         * @param {object} report
         * @param {boolean} isLatest
         * @param {number} globalPosition  1-indexed position across all pages (newest = 1)
         */
        function createReportCard(report, isLatest, globalPosition) {
            const card = document.createElement('div');
            card.className = 'report-card clickable-row';

            let imageUrl = report.gambar || '';
            if (imageUrl && imageUrl.includes('drive.google.com')) {
                let fileId = '';
                if (imageUrl.includes('id=')) fileId = imageUrl.split('id=')[1].split('&')[0];
                else if (imageUrl.includes('/file/d/')) fileId = imageUrl.split('/file/d/')[1].split('/')[0];
                if (fileId) imageUrl = `https://drive.google.com/thumbnail?id=${fileId}&sz=w400`;
            }
            if (!imageUrl) imageUrl = 'https://via.placeholder.com/400x300?text=Tiada+Gambar';

            const uid = report.uniqueId || `report_${globalPosition}`;
            const count = getLikeCount(uid, globalPosition);
            const liked = isLiked(uid);

            // Build liked-by preview (use mock avatars based on position)
            const avatarCount = Math.min(count, 5);
            const avatarHtml = count > 0
                ? Array.from({ length: avatarCount }, (_, i) => {
                    const av = AVATAR_POOL[(globalPosition + i) % AVATAR_POOL.length];
                    return `<div class="avatar-bubble ${av.cls}">${av.initial}</div>`;
                }).join('')
                : '';

            const othersCount = count - avatarCount;
            const firstName = count > 0 ? AVATAR_POOL[globalPosition % AVATAR_POOL.length].initial : '';
            const likedByText = count === 0
                ? '<span style="font-style:italic;color:var(--text-secondary);">Belum ada yang suka lagi</span>'
                : `<div class="liked-by-avatars">${avatarHtml}</div>
                   <span>${firstName}${othersCount > 0 ? ` dan <strong>${othersCount}</strong> orang lain` : ''} menyukai ini</span>`;

            card.innerHTML = `
                <div class="report-date">
                    <div class="date-day">${report.tarikh}</div>
                    <div class="date-details">${report.hari}</div>
                    <div class="date-details">${report.masa}</div>
                    ${isLatest ? '<span class="badge">Terkini</span>' : ''}
                </div>
                <div class="report-content">
                    <h3>Aktiviti asrama:</h3>
                    <p>${report.butiran}</p>
                </div>
                <div class="report-images">
                    <div class="report-image">
                        <img src="${imageUrl}" alt="Aktiviti"
                             onerror="this.onerror=null;this.src='https://via.placeholder.com/400x300?text=Gambar+Tidak+Tersedia';">
                    </div>
                </div>

                <!-- LIKE FOOTER -->
                <div class="report-footer">
                    <div class="liked-by">${likedByText}</div>

                    <div class="like-section">
                        <button class="like-btn ${liked ? 'liked' : ''}"
                                data-uid="${uid}"
                                data-pos="${globalPosition}"
                                title="${liked ? 'Buang suka' : 'Suka laporan ini'}">
                            <span class="heart-icon">${liked ? '‚ù§Ô∏è' : 'ü§ç'}</span>
                            <span class="like-count">${formatLikeCount(count)}</span>
                            <span class="like-label">suka</span>
                        </button>
                    </div>
                </div>
            `;

            // Click on card body ‚Üí open print modal (but NOT on like button)
            card.addEventListener('click', function(e) {
                if (!e.target.closest('.like-btn') && !e.target.closest('.report-footer')) {
                    openPrintModal(report);
                }
            });

            // Like button handler ‚Äî stop propagation so it doesn't open print modal
            const likeBtn = card.querySelector('.like-btn');
            likeBtn.addEventListener('click', async function(e) {
                e.stopPropagation();
                const countEl = this.querySelector('.like-count');
                await toggleLike(uid, globalPosition, countEl, this);
            });

            return card;
        }

        async function saveReportToSheet(reportData) {
            try {
                await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'saveReport', data: reportData })
                });
                return { success: true };
            } catch (error) {
                console.error('Error saving report:', error);
                return { success: false, error: error.message };
            }
        }

        function convertImageToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // ============================================
        // FORM SUBMISSION
        // ============================================
        document.getElementById('reportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = this.querySelector('.btn-submit');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '‚è≥ Menyimpan...';
            showLoading('Menyimpan laporan...', 'Mohon tunggu, data sedang diproses');
            submitBtn.disabled = true;

            try {
                const dateInput = document.getElementById('tarikh').value;
                const timeInput = document.getElementById('masa').value;

                let formattedTime;
                try { formattedTime = formatTime(timeInput); }
                catch (err) { throw new Error(err.message); }

                const date = new Date(dateInput);
                const tarikh = `'${date.getDate()}.${String(date.getMonth() + 1).padStart(2, '0')}.${date.getFullYear()}`;
                const days = ['Ahad','Isnin','Selasa','Rabu','Khamis','Jumaat','Sabtu'];
                const hari = days[date.getDay()];
                const uniqueId = createUniqueId(dateInput, timeInput);
                const butiran = document.getElementById('butiran').value;

                const fileInput = document.getElementById('fileInput');
                let imageBase64 = '';
                if (fileInput.files.length > 0) imageBase64 = await convertImageToBase64(fileInput.files[0]);

                const reportData = { uniqueId, tarikh, hari, masa: formattedTime, butiran, gambar: imageBase64, folderId: DRIVE_FOLDER_ID, timestamp: new Date().toISOString() };
                const result = await saveReportToSheet(reportData);

                if (result.success) {
                    alert('‚úÖ Laporan berjaya disimpan!');
                    this.reset();
                    removeImage();
                    document.querySelector('.tab:first-child').click();
                    setTimeout(() => loadReportsFromSheet(), 500);
                } else {
                    throw new Error(result.error || 'Gagal menyimpan laporan');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå Ralat: ' + error.message);
            } finally {
                hideLoading();
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        });

        // ============================================
        // PAGINATION
        // ============================================
        let currentPage = 1;
        let totalReports = 23;

        document.querySelectorAll('.nav-btn').forEach((btn, index) => {
            btn.addEventListener('click', function() {
                if (index === 0) { if (currentPage > 1) { currentPage--; loadReportsFromSheet(); } }
                else { currentPage++; loadReportsFromSheet(); }
            });
        });

        function updatePaginationInfo(total) {
            totalReports = total;
            const start = (currentPage - 1) * 5 + 1;
            const end = Math.min(currentPage * 5, totalReports);
            const totalPages = Math.ceil(totalReports / 5);

            document.querySelector('.page-info').innerHTML =
                `Menunjukkan <strong>${start}-${end}</strong> daripada <strong>${totalReports}</strong> laporan`;

            const [prevBtn, nextBtn] = document.querySelectorAll('.nav-btn');
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        window.addEventListener('load', async function() {
            await loadLikeState();
            loadReportsFromSheet();
            console.log('Sistem Laporan Aktiviti Asrama dimulakan.');
        });
    </script>
</body>
</html>
